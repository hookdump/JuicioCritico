<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i|Roboto+Slab:400,700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link href="estilos.css" rel="stylesheet">
  <link href="../_lib/jquery-ui/jquery-ui.min.css" rel="stylesheet">
  <link href="../_lib/jquery-ui/jquery-ui.structure.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="../_lib/smoothscrollto.jquery.js"></script>
  <script src="../_lib/jquery-ui/jquery-ui.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js" integrity="sha256-xKeoJ50pzbUGkpQxDYHD7o7hxe0LaOGeguUidbq6vis=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js" integrity="sha256-VeNaFBVDhoX3H+gJ37DpT/nTuZTdjYro9yBruHjVmoQ=" crossorigin="anonymous"></script>

<script type="text/javascript">
$( document ).ready(function() {
  const EASING_QUART = 'easeOutQuart';
  const EASING_QUAD = 'easeOutQuad';

  function locale(nro) {
    return nro.toLocaleString().replace(/,/g, ".");
  };
  function animarContador(valorActual, valorNuevo, $elemento, opt) {
    if (!opt) opt = {};
    var formatear = (_data) => {
      var _val;
      if (opt.decimales) {
        _val = _data.toFixed(opt.decimales);
      } else {
        _val = parseInt(_data);
      }
      if (opt.sufijo) _val += opt.sufijo;
      return _val;
    }
    return new Promise(function(resolve, reject) {
      var _easing = opt.easing ? opt.easing : 'easeOutQuad';
      var _dur = opt.duration ? opt.duration : 2000;
      console.log('Animando contador:', valorNuevo, $elemento);
      $({num: valorActual}).stop(true).animate({num: valorNuevo}, {
        duration : _dur,
        easing: _easing,
        step: function () {
          $elemento.text(formatear(this.num));
        }
      }).promise().done(function () {
          $elemento.text(formatear(valorNuevo));
          return resolve();
      });
    });
  }
  $.fn.animateRotate = function(angle, duration, easing, complete) {
    var args = $.speed(duration, easing, complete);
    var step = args.step;
    return this.each(function(i, e) {
      args.complete = $.proxy(args.complete, e);
      args.step = function(now) {
        $.style(e, 'transform', 'rotate(' + now + 'deg)');
        if (step) return step.apply(e, arguments);
      };

      $({deg: 0}).animate({deg: angle}, args);
    });
  };
  var defaultDelay = 300;
  var defaultEasing = "linear";
  var mapa = [];
  var pos = 0; // DONT OVERRIDE. USE ID!

  // --- MAPA ---
  mapa = mapa.concat([
    {y: 0, id: 'COMIENZO'},
    {y: 300},
    {y: 400},
    {y: 550},
    {y: 600},
    {y: 2014, id: 'FLOR'},
    {animacion: 'play_flor'},
    {animacion: 'ingredientes0', id: 'INGREDIENTES'},
    {animacion: 'ingredientes1'},
    {animacion: 'ingredientes2'},
    {animacion: 'torta1'},
    {animacion: 'torta2'},
    {animacion: 'torta3'},
    {animacion: 'ingredientes3'},
    {animacion: 'ingredientes4'},
    {animacion: 'ingredientes_highlight1'},
    {animacion: 'ingredientes_highlight2'},
    {animacion: 'ingredientes_highlight3'},
    {animacion: 'ingredientes_highlight4'},
    {animacion: 'ingredientes2'},
    {animacion: 'ingredientes4'},
    {animacion: 'ingredientes_open1'},
    {animacion: 'ingredientes_open2'},
    {animacion: 'ingredientes_highlight5'},
    // {animacion: 'parte1', id: 'EPISODIOS'},
    // {animacion: 'parte2'},
    // {animacion: 'parte1_center'},

    // {y: 1000, delay: 1800, easing: 'easeOutQuart'},
    // {animacion: 'nombre'}
  ]);

  // $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
  var jumpToId = '';
  // jumpToId = 'FLOR';

  // Inicializacion
  console.log("Start!");
  if (jumpToId !== '') {
    var _mapaTarget = _.findIndex(mapa, {id: jumpToId});
    pos = _mapaTarget - 1;
    nextPos();
  } else {
    scrollToPos(0);
  }
  /*if (pos > 0) {
    pos--;
    nextPos(); */
  // $("HTML, BODY").animate({ scrollTop: mapa[pos].y }, 300);
  AOS.init();

  function scrollToPos(y, delay, easing, cb) {
    console.log('scroll:',y,delay,easing);
    delay = delay || defaultDelay;
    easing = easing || defaultEasing;
    $("HTML, BODY").animate({ scrollTop: y }, delay, easing, () => {
      console.log('anim done!');
      if (cb) {
        return cb();
      }
    });
  };

  function mostrarPos() {
    var show = document.body.scrollTop + " / " + pos;
    if (mapa[pos].id)         show = `<b>${mapa[pos].id}</b> @ ${show}`;
    if (mapa[pos].animacion)  show = `<small>(${mapa[pos].animacion})</small> ${show}`;
    $('.scrollDisplay').html(show);
  }

  function nextPos() {
    pos++;
    if (pos >= mapa.length) {
      $('.scrollDisplay').text(document.body.scrollTop + " / " + "FIN");
      return;
    } else {
      console.log('Going to pos ' + pos + '/' + mapa.length);
    }
    var easing = mapa[pos].easing || defaultEasing;
    var delay = mapa[pos].delay || defaultDelay;

    if (mapa[pos].y) {
      scrollToPos(mapa[pos].y, delay, easing);
    }
    // animacion
    if (mapa[pos].animacion) {
      ejecutarAnimacion(mapa[pos].animacion);
    }
  };

  function esperar(delay) {
    if (!delay) delay = 700;
    return new Promise((resolve, reject) => {
      setTimeout(resolve, delay);
    });
  };

  function ejecutarAnimacion(id) {
    const BG_OPACITY = 0.15;
    console.log('ejecutando animacion:', id);
    var genericDelay = 600;
    mostrarPos();

    switch(id) {
      case 'play_flor':
      $('.video1')[0].play();
      break;

      case 'parte1':
      scrollToPos(1750, 1000, 'easeOutQuart');
      $(".hparte2").animate({opacity: 0.1}, 500);
      $(".hparte1 em").css({'text-shadow': '0 0 10px white'});
      $(".hparte1 span").css({'text-shadow': '0 0 10px red'});
      break;

      case 'parte2':
      $(".hparte1").animate({opacity: 0.1}, 500);
      $(".hparte2").animate({opacity: 1}, 500);
      $(".hparte1 em").css({'text-shadow': 'none'});
      $(".hparte1 span").css({'text-shadow': 'none'});
      $(".hparte2 em").css({'text-shadow': '0 0 10px white'});
      $(".hparte2 span").css({'text-shadow': '0 0 10px red'});
      break;

      case 'parte1_center':
      $(".hparte2").animate({
        'top': '-=300',
        'font-size': 100,
        'transform': 'scale(1.5)',
        opacity: 1
      }, 1200, 'easeOutQuart');
      $(".hparte1").animate({'top': '-=700', opacity: 0}, 600);
      $(".hparte2 em").css({'text-shadow': '0 0 10px white'});
      $(".hparte2 span").css({'text-shadow': '0 0 10px red'});
      break;

      case 'ingredientes0':
      $('.video1').fadeOut();
      $('.ing_white').animate({opacity: 1});
      break;

      case 'ingredientes1':
      $('.ing_white').animate({'opacity': 0}, 200);
      $('.ing1').animate({'opacity': 1,'left': '-=500'}, 1000, EASING_QUART);
      $('.ing2').animate({'opacity': 1}, 1000, EASING_QUART);
      $('.ing3').animate({'opacity': 1, 'left': '+=500'}, 1000, EASING_QUART);
      // $('.label').animate({opacity: 1}, 2000, EASING_QUART);
      break;

      case 'ingredientes2':
      $('.ing1').animate({'opacity': 0,'left': '+=500'}, 1000, EASING_QUART);
      $('.ing2').animate({'opacity': 0}, 1000, EASING_QUART);
      $('.ing3').animate({'opacity': 0, 'left': '-=500'}, 1000, EASING_QUART);
      $('.ing_white').delay(300).animate({'opacity': 1}, 300);
      break;

      case 'torta1':
      $('.ing').animate({'opacity': '0'}, 1000, EASING_QUART);
      $('.torta_full').animate({'opacity': '1'}, 1000, EASING_QUART);
      break;

      case 'torta2':
      $('.torta_full').animate({opacity: 0}, 300);
      esperar(200).then(() => {
        $('.torta1').animate({'opacity': 1, 'left': '-=500'}, 1000, EASING_QUART);
        $('.torta2').animate({'opacity': 1, 'left': '-=180'}, 1000, EASING_QUART);
        $('.torta3').animate({'opacity': 1, 'left': '+=180'}, 1000, EASING_QUART);
        $('.torta4').animate({'opacity': 1, 'left': '+=500'}, 1000, EASING_QUART);
      });
      break;

      case 'torta3':
      $('.torta1').animate({'opacity': 0, 'left': '+=400'}, 1000, EASING_QUART);
      $('.torta2').animate({'opacity': 0, 'left': '+=180'}, 1000, EASING_QUART);
      $('.torta3').animate({'opacity': 0, 'left': '-=180'}, 1000, EASING_QUART);
      $('.torta4').animate({'opacity': 0, 'left': '-=500'}, 1000, EASING_QUART);
      esperar(300).then(() => {
        $('.torta_full').animate({opacity: 1}, 300);
      });
      break;

      case 'ingredientes3':
      $('.torta_full').animate({'opacity': 0}, 1000);
      $('.ing_white').animate({'opacity': 1}, 1000);
      $('.label').animate({'opacity': 1}, 1000);
      break;

      case 'ingredientes4':
      $('.ing_white').animate({'opacity': 0}, 400);
      $('.ing1').animate({'opacity': 1,'left': '-=500'}, 1700, EASING_QUART);
      $('.ing2').animate({'opacity': 1}, 1700, EASING_QUART);
      $('.ing3').animate({'opacity': 1, 'left': '+=500'}, 1700, EASING_QUART);
      break;

      case 'ingredientes_highlight1':
      $('.ing2').animate({opacity: BG_OPACITY}, 400);
      $('.ing3').animate({opacity: BG_OPACITY}, 400);
      $('.episodio1').animate({opacity: 1});
      $('.indicador1').animate({opacity: 1});
      break;

      case 'ingredientes_highlight2':
      $('.ing1').animate({opacity: BG_OPACITY}, 400);
      $('.ing2').animate({opacity: 1}, 400);
      $('.ing3').animate({opacity: BG_OPACITY}, 400);
      $('.indicador1').animate({opacity: BG_OPACITY});
      $('.episodio1').animate({opacity: BG_OPACITY});
      $('.episodio2').animate({opacity: 1});
      $('.indicador2').animate({opacity: 1});
      break;

      case 'ingredientes_highlight3':
      $('.ing1').animate({opacity: BG_OPACITY});
      $('.ing2').animate({opacity: BG_OPACITY});
      $('.ing3').animate({opacity: 1});
      break;


      case 'ingredientes_highlight4':
      $('.episodio1').animate({opacity: 0});
      $('.episodio2').animate({opacity: 0});
      $('.indicador1').animate({opacity: 0});
      $('.indicador2').animate({opacity: 0});
      $('.indicador3').animate({opacity: 0});
      $('.ing1').animate({opacity: 1});
      $('.ing2').animate({opacity: 1});
      $('.ing3').animate({opacity: 1});
      break;

      case 'ingredientes_open1':
      $('.ing2').addClass('big');
      break;

      case 'ingredientes_open2':
      $('.ing2').removeClass('big');
      break;

      case 'ingredientes_highlight5':
      $('.ing1').animate({opacity: BG_OPACITY});
      $('.ing2').animate({opacity: BG_OPACITY});
      $('.ing3').animate({opacity: 1});
      break;
    }
  }

  window.onscroll = function() {
    mostrarPos();
  };
  $('body').mousedown(function(ev) {
    if (ev.which === 3) {
      nextPos();
    }
  });

  mostrarPos();
});
</script>
 <meta charset="UTF-8">
</head>
<body class="noselect" oncontextmenu="return false">
  <div class="scrollDisplay">0</div>

  <!-- ............. COMIENZO ............. -->
  <div class="spacer-600"> </div>
  <h1 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    ¡Hola!
  </h1>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    Te invito a que exploremos
  </h2>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    los distintos componentes
  </h2>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    del <span>Telar de la Abundancia</span>
  </h2>
  <div class="spacer-700"> </div>

<video class="video1">
  <source src="../Piramides/FLOR3.mp4" type="video/mp4">
</video>


  <div class='episodios_labels'>
    <div class="indicador indicador1">
    </div>
    <h2 class="hparte1 episodio1">
      Episodio 1
    </h2>
    <div class="indicador indicador2">
    </div>
    <h2  class="hparte2 episodio2">
      Episodio 2
    </h2>
  </div>


  <div class="spacer-100"> </div>

  <div class="ingredientes">
    <div class="ing ing1 component">
      <span class="label">Matemático</span>
    </div>
    <div class="ing ing_white">
      <span class="label">Telar de la Abundancia</span>
    </div>
    <div class="ing ing2 component">
      <span class="label">Psicológico</span>
    </div>
    <div class="ing ing3 component">
      <span class="label">Cultural y Social</span>
    </div>
    <div class="torta_item torta_full"></div>
    <div class="torta_item torta_ingrediente torta1"></div>
    <div class="torta_item torta_ingrediente torta2"></div>
    <div class="torta_item torta_ingrediente torta3"></div>
    <div class="torta_item torta_ingrediente torta4"></div>
  </div>

  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>

</body>
</html>
