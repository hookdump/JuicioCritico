<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i|Roboto+Slab:400,700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link href="estilos.css" rel="stylesheet">
  <link href="../_lib/jquery-ui/jquery-ui.min.css" rel="stylesheet">
  <link href="../_lib/jquery-ui/jquery-ui.structure.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="../_lib/smoothscrollto.jquery.js"></script>
  <script src="../_lib/jquery-ui/jquery-ui.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js" integrity="sha256-xKeoJ50pzbUGkpQxDYHD7o7hxe0LaOGeguUidbq6vis=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js" integrity="sha256-VeNaFBVDhoX3H+gJ37DpT/nTuZTdjYro9yBruHjVmoQ=" crossorigin="anonymous"></script>

<script type="text/javascript">
$( document ).ready(function() {
  const EASING_QUART = 'easeOutQuart';
  const EASING_QUAD = 'easeOutQuad';

  function locale(nro) {
    return nro.toLocaleString().replace(/,/g, ".");
  };
  function animarContador(valorActual, valorNuevo, $elemento, opt) {
    if (!opt) opt = {};
    var formatear = (_data) => {
      var _val;
      if (opt.decimales) {
        _val = _data.toFixed(opt.decimales);
      } else {
        _val = parseInt(_data);
      }
      if (opt.sufijo) _val += opt.sufijo;
      return _val;
    }
    return new Promise(function(resolve, reject) {
      var _easing = opt.easing ? opt.easing : 'easeOutQuad';
      var _dur = opt.duration ? opt.duration : 2000;
      console.log('Animando contador:', valorNuevo, $elemento);
      $({num: valorActual}).stop(true).animate({num: valorNuevo}, {
        duration : _dur,
        easing: _easing,
        step: function () {
          $elemento.text(formatear(this.num));
        }
      }).promise().done(function () {
          $elemento.text(formatear(valorNuevo));
          return resolve();
      });
    });
  }
  $.fn.animateRotate = function(angle, duration, easing, complete) {
    var args = $.speed(duration, easing, complete);
    var step = args.step;
    return this.each(function(i, e) {
      args.complete = $.proxy(args.complete, e);
      args.step = function(now) {
        $.style(e, 'transform', 'rotate(' + now + 'deg)');
        if (step) return step.apply(e, arguments);
      };

      $({deg: 0}).animate({deg: angle}, args);
    });
  };
  var defaultDelay = 300;
  var defaultEasing = "linear";
  var mapa = [];
  var pos = 0; // DONT OVERRIDE. USE ID!

  // --- MAPA ---
  mapa = mapa.concat([
    {y: 0, id: 'COMIENZO'},
    {y: 300},
    {y: 400},
    {y: 700},
    {y: 1050},
    {y: 1200},
    {y: 2014, id: 'FLOR'},
    {animacion: 'objetivo1'},
    {animacion: 'objetivo2'},
    {animacion: 'objetivo3'},
    {animacion: 'ingredientes0', id: 'INGREDIENTES'},
    {animacion: 'ingredientes3'},
    {animacion: 'ingredientes_highlight1'},
    {animacion: 'ingredientes_highlight_scroll'},
    {animacion: 'posi1'},
    {animacion: 'posi2'},
    {animacion: 'posi3'},
    {animacion: 'posi4'},
    {animacion: 'posi5'},
    {animacion: 'ingredientes_highlight2'},
    {animacion: 'nega1'},
    {animacion: 'nega2'},
    {animacion: 'nega3'},
    {animacion: 'nega4'},
    {animacion: 'nega5'},

    /* LADO CULTURAL SOCIAL */



    /* LADO PSICOLOGICO */
    {animacion: 'ingredientes_highlight3'},
    {animacion: 'ingredientes_highlight4'},
    // {y: 1000, delay: 1800, easing: 'easeOutQuart'},
    // {animacion: 'nombre'}
  ]);

  // $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
  var jumpToId = 'INGREDIENTES';
  // jumpToId = 'FLOR';

  // Inicializacion
  console.log("Start!");
  if (jumpToId !== '') {
    var _mapaTarget = _.findIndex(mapa, {id: jumpToId});
    pos = _mapaTarget - 1;
    nextPos();
  } else {
    scrollToPos(0);
  }
  /*if (pos > 0) {
    pos--;
    nextPos(); */
  // $("HTML, BODY").animate({ scrollTop: mapa[pos].y }, 300);
  AOS.init();

  function scrollToPos(y, delay, easing, cb) {
    console.log('scroll:',y,delay,easing);
    delay = delay || defaultDelay;
    easing = easing || defaultEasing;
    $("HTML, BODY").animate({ scrollTop: y }, delay, easing, () => {
      console.log('anim done!');
      if (cb) {
        return cb();
      }
    });
  };

  function mostrarPos() {
    var show = document.body.scrollTop + " / " + pos;
    if (mapa[pos].id)         show = `<b>${mapa[pos].id}</b> @ ${show}`;
    if (mapa[pos].animacion)  show = `<small>(${mapa[pos].animacion})</small> ${show}`;
    $('.scrollDisplay').html(show);
  }

  function nextPos() {
    pos++;
    if (pos >= mapa.length) {
      $('.scrollDisplay').text(document.body.scrollTop + " / " + "FIN");
      return;
    } else {
      console.log('Going to pos ' + pos + '/' + mapa.length);
    }
    var easing = mapa[pos].easing || defaultEasing;
    var delay = mapa[pos].delay || defaultDelay;

    if (mapa[pos].y) {
      scrollToPos(mapa[pos].y, delay, easing);
    }
    // animacion
    if (mapa[pos].animacion) {
      ejecutarAnimacion(mapa[pos].animacion);
    }
  };

  function esperar(delay) {
    if (!delay) delay = 700;
    return new Promise((resolve, reject) => {
      setTimeout(resolve, delay);
    });
  };

  function ejecutarAnimacion(id) {
    const BG_OPACITY = 0.25;
    console.log('ejecutando animacion:', id);
    var genericDelay = 600;
    mostrarPos();

    switch(id) {
      case 'objetivo1':
      $('.overlayObjetivo .left').animate({opacity: 1});
      break;
      case 'objetivo2':
      $('.overlayObjetivo .right').animate({opacity: 1});
      break;
      case 'objetivo3':
      $('.video1')[0].play();
      $('.overlayObjetivo .entender').animate({opacity: 1});
      break;

      case 'ingredientes0':
      scrollToPos(2800);
      $('.video1').fadeOut();
      $('.ing_white').animate({opacity: 1});
      $('.label').animate({'opacity': 1}, 1000);
      break;

      case 'ingredientes3':
      $('.ing_white').animate({'opacity': 0}, 200);
      $('.ing1').animate({'opacity': 1,'left': '-=480'}, 1700, EASING_QUART);
      // $('.ing2').animate({'opacity': 1}, 1700, EASING_QUART);
      $('.ing3').animate({'opacity': 1, 'left': '+=480'}, 1700, EASING_QUART);
      break;

      case 'ingredientes_highlight1':
      // $('.ing2').animate({opacity: BG_OPACITY});
      $('.ing3').animate({opacity: BG_OPACITY});
      $('.episodio1').animate({opacity: 1});
      $('.indicador1').animate({opacity: 1});
      break;

      case 'ingredientes_highlight2':
      $('.ing1').animate({opacity: BG_OPACITY}, 400);
      // $('.ing2').animate({opacity: BG_OPACITY}, 400);
      $('.ing3').animate({opacity: 1}, 400);
      $('.indicador1').animate({opacity: BG_OPACITY});
      $('.episodio1').animate({opacity: BG_OPACITY});
      $('.episodio2').animate({opacity: 1});
      $('.indicador2').animate({opacity: 1});
      $('.posinega .positivo').animate({opacity: BG_OPACITY});
      break;

      case 'ingredientes_highlight_scroll':
      scrollToPos(3350, 1000, EASING_QUART);
      break;

      case 'posi1': $('.posi1').animate({opacity: 1}); break;
      case 'posi2': $('.posi2').animate({opacity: 1}); break;
      case 'posi3': $('.posi3').animate({opacity: 1}); break;
      case 'posi4': $('.posi4').animate({opacity: 1}); break;
      case 'posi5': $('.posi5').animate({opacity: 1}); break;

      case 'nega1': $('.nega1').animate({opacity: 1}); break;
      case 'nega2': $('.nega2').animate({opacity: 1}); break;
      case 'nega3': $('.nega3').animate({opacity: 1}); break;
      case 'nega4': $('.nega4').animate({opacity: 1}); break;
      case 'nega5': $('.nega5').animate({opacity: 1}); break;

      case 'ingredientes_highlight3':
      $('.ing1').animate({opacity: BG_OPACITY});
      // $('.ing2').animate({opacity: 1});
      $('.ing3').animate({opacity: BG_OPACITY});
      break;


      case 'ingredientes_highlight4':
      $('.episodio1').animate({opacity: 0});
      $('.episodio2').animate({opacity: 0});
      $('.indicador1').animate({opacity: 0});
      $('.indicador2').animate({opacity: 0});
      $('.indicador3').animate({opacity: 0});
      $('.ing1').animate({opacity: 1});
      // $('.ing2').animate({opacity: 1});
      $('.ing3').animate({opacity: 1});
      break;

    }
  }


  window.onscroll = function() {
    mostrarPos();
  };
  $('body').mousedown(function(ev) {
    if (ev.which === 3) {
      nextPos();
    }
  });

  mostrarPos();
});
</script>
 <meta charset="UTF-8">
</head>
<body class="noselect" oncontextmenu="return false">
  <div class="scrollDisplay">0</div>

  <!-- ............. COMIENZO ............. -->
  <div class="spacer-600"> </div>
  <h1 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    Hey, vos...
  </h1>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    Si, ¡vos!
  </h2>

  <div class="spacer-100"></div>

  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    <span>¿Estás en un Telar<br />de la Abundancia?</span>
  </h2>

  <div class="spacer-100"></div>

  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    ¿Te intriga entender<br />por qué tanta gente
  </h2>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    <span>desconfía</span> y <span>critica</span> al sistema?
  </h2>
  <div class="spacer-700"> </div>

<div class="overlayObjetivo">
    <h2 class="left">CRITICAR</h2>
    <h2 class="right">DEFENDER</h2>
    <h1 class="entender">ENTENDER</h1>
</div>
<video class="video1">
  <source src="../Piramides/FLOR3.mp4" type="video/mp4">
</video>


<!--
  <div class='episodios_labels' style="display: none;">
    <div class="indicador indicador1">
    </div>
    <h2 class="hparte1 episodio1">
      Episodio 1
    </h2>
    <div class="indicador indicador2">
    </div>
    <h2  class="hparte2 episodio2">
      Episodio 2
    </h2>
  </div>
-->

  <div class="spacer-300"> </div>

  <div class="ingredientes">
    <div class="ing ing1 component">
      <span class="label">Positivo</span>
    </div>
    <div class="ing ing_white">
      <span class="label">Telar de la Abundancia</span>
    </div>
    <div class="ing ing2 component">
      <span class="label"></span>
    </div>
    <div class="ing ing3 component">
      <span class="label">Negativo</span>
    </div>
    <div class="torta_item torta_full"></div>
    <div class="torta_item torta_ingrediente torta1"></div>
    <div class="torta_item torta_ingrediente torta2"></div>
    <div class="torta_item torta_ingrediente torta3"></div>
    <div class="torta_item torta_ingrediente torta4"></div>
  </div>

  <div class='posinega'>
    <div class='adentro positivo'>
      <ul>
        <li class='posi1'>Apoyo mutuo</li>
        <li class='posi2'>Mentalidad de la abundancia</li>
        <li class='posi3'>Empoderamiento femenino</li>
        <li class='posi4'>Recursos para cumplir sueños y proyectos</li>
        <li class='posi5'>Recursos para cumplir sueños y proyectos</li>
      </ul>
    </div>
    <div class='adentro negativo'>
      <ul>
        <li class='nega1'>Apoyo mutuo</li>
        <li class='nega2'>Mentalidad de la abundancia</li>
        <li class='nega3'>Empoderamiento femenino</li>
        <li class='nega4'>Recursos para cumplir sueños y proyectos</li>
        <li class='nega5'>Recursos para cumplir sueños y proyectos</li>
      </ul>
    </div>
  </div>

  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>

</body>
</html>
