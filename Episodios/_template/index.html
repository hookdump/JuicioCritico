<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i|Roboto+Slab:400,700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link href="estilos.css" rel="stylesheet">
  <link href="../_lib/jquery-ui/jquery-ui.min.css" rel="stylesheet">
  <link href="../_lib/jquery-ui/jquery-ui.structure.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="../_lib/smoothscrollto.jquery.js"></script>
  <script src="../_lib/jquery-ui/jquery-ui.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js" integrity="sha256-xKeoJ50pzbUGkpQxDYHD7o7hxe0LaOGeguUidbq6vis=" crossorigin="anonymous"></script>

<script type="text/javascript">
$( document ).ready(function() {
  function locale(nro) {
    return nro.toLocaleString().replace(/,/g, ".");
  };
  function animarContador(valorActual, valorNuevo, $elemento, opt) {
    if (!opt) opt = {};
    var formatear = (_data) => {
      var _val;
      if (opt.decimales) {
        _val = _data.toFixed(opt.decimales);
      } else {
        _val = parseInt(_data);
      }
      if (opt.sufijo) _val += opt.sufijo;
      return _val;
    }
    return new Promise(function(resolve, reject) {
      var _easing = opt.easing ? opt.easing : 'easeOutQuad';
      var _dur = opt.duration ? opt.duration : 2000;
      console.log('Animando contador:', valorNuevo, $elemento);
      $({num: valorActual}).stop(true).animate({num: valorNuevo}, {
        duration : _dur,
        easing: _easing,
        step: function () {
          $elemento.text(formatear(this.num));
        }
      }).promise().done(function () {
          $elemento.text(formatear(valorNuevo));
          return resolve();
      });
    });
  }
  $.fn.animateRotate = function(angle, duration, easing, complete) {
    var args = $.speed(duration, easing, complete);
    var step = args.step;
    return this.each(function(i, e) {
      args.complete = $.proxy(args.complete, e);
      args.step = function(now) {
        $.style(e, 'transform', 'rotate(' + now + 'deg)');
        if (step) return step.apply(e, arguments);
      };

      $({deg: 0}).animate({deg: angle}, args);
    });
  };
  var defaultDelay = 300;
  var defaultEasing = "linear";
  var mapa = [];

  // --- MAPA ---
  mapa = mapa.concat([
    {y: 0},   // 0
    {y: 300}, // 1
    {y: 400}, // 2
    {y: 550}, // 3
    {y: 600}, // 4
    {y: 798, delay: 700},
    {animacion: 'emoji_amor'},
    {animacion: 'emoji_odio'},
    {animacion: 'emoji_pensando'},
    {y: 1760}, // 9
    {animacion: 'parte1'},
    {animacion: 'parte2'},
    {animacion: 'parte1_center'}
    // {y: 1000, delay: 1800, easing: 'easeOutQuart'},
    // {animacion: 'nombre'}
  ]);

  // $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
  // 0 - Inicio
  var pos = 0;

  // Inicializacion
  console.log("Start!");
  if (pos > 0) {
    pos--;
    nextPos();
  } else {
    scrollToPos(0);
  }
  // $("HTML, BODY").animate({ scrollTop: mapa[pos].y }, 300);
  AOS.init();

  function scrollToPos(y, delay, easing, cb) {
    console.log('scroll:',y,delay,easing);
    delay = delay || defaultDelay;
    easing = easing || defaultEasing;
    $("HTML, BODY").animate({ scrollTop: y }, delay, easing, () => {
      console.log('anim done!');
      if (cb) {
        return cb();
      }
    });
  };

  function nextPos() {
    pos++;
    if (pos >= mapa.length) {
      $('.scrollDisplay').text(document.body.scrollTop + " / " + "FIN");
      return;
    } else {
      console.log('Going to pos ' + pos + '/' + mapa.length);
    }
    var easing = mapa[pos].easing || defaultEasing;
    var delay = mapa[pos].delay || defaultDelay;
    $('.scrollDisplay').text(document.body.scrollTop + " / " + pos);
    if (mapa[pos].y) {
      scrollToPos(mapa[pos].y, delay, easing);
    }
    // animacion
    if (mapa[pos].animacion) {
      ejecutarAnimacion(mapa[pos].animacion);
    }
  };

  function esperar(delay) {
    if (!delay) delay = 700;
    return new Promise((resolve, reject) => {
      setTimeout(resolve, delay);
    });
  };

  function ejecutarAnimacion(id) {
    console.log('ejecutando animacion:', id);
    var genericDelay = 600;

    switch(id) {
      case 'emoji_amor':
      $('.emoji_amor').animate({opacity: 1});
      break;

      case 'parte1':
      scrollToPos(1750, 1000, 'easeOutQuart');
      $(".hparte2").animate({opacity: 0.1}, 500);
      $(".hparte1 em").css({'text-shadow': '0 0 10px white'});
      $(".hparte1 span").css({'text-shadow': '0 0 10px red'});
      break;

      case 'parte2':
      $(".hparte1").animate({opacity: 0.1}, 500);
      $(".hparte2").animate({opacity: 1}, 500);
      $(".hparte1 em").css({'text-shadow': 'none'});
      $(".hparte1 span").css({'text-shadow': 'none'});
      $(".hparte2 em").css({'text-shadow': '0 0 10px white'});
      $(".hparte2 span").css({'text-shadow': '0 0 10px red'});
      break;

      case 'parte1_center':
      $(".hparte2").animate({
        'top': '-=300',
        'font-size': 100,
        'transform': 'scale(1.5)',
        opacity: 1
      }, 1200, 'easeOutQuart');
      $(".hparte1").animate({'top': '-=700', opacity: 0}, 600);
      $(".hparte2 em").css({'text-shadow': '0 0 10px white'});
      $(".hparte2 span").css({'text-shadow': '0 0 10px red'});
      break;



    }
  }

  window.onscroll = function() {
    $('.scrollDisplay').text(document.body.scrollTop + " / " + pos);
  };
  $('body').mousedown(function(ev) {
    if (ev.which === 3) {
      nextPos();
    }
  });
});
</script>
 <meta charset="UTF-8">
</head>
<body class="noselect" oncontextmenu="return false">
  <div class="scrollDisplay">0</div>

  <!-- ............. COMIENZO ............. -->
  <div class="spacer-600"> </div>
  <h1 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    Â¡Hola!
  </h1>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    Te invito a que exploremos
  </h2>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    c&oacute;mo funciona
  </h2>
  <h2 data-aos-anchor-placement="center-center"  data-aos="flip-down">
    <span>el Telar de la Abundancia</span>
  </h2>
  <div class="spacer-700"> </div>


  <div>
    <div class="spacer-500"> </div>

    <h2 class="hparte1" data-aos-anchor-placement="center-center" data-aos="flip-down"
    style="position: absolute; margin-top: -450px; text-align: center; width: 100%; ">
      <span>Episodio 1</span><br /><em style="font-style: normal">Aspecto matem&aacute;tico</em></h2>

    <h2  class="hparte2" data-aos-anchor-placement="bottom-bottom" data-aos="flip-down"
    style="position: absolute; margin-bottom: -400px; text-align: center; width: 100%; ">
      <span>Episodio 2</span><br />Aspecto psicol&oacute;gico</h2>

    <div class="spacer-500"> </div>
  </div>


  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>
  <div class="spacer-600"> </div>

</body>
</html>
